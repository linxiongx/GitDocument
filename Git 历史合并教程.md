# 📖 Git 历史合并教程：将多个零碎提交整理为一个干净提交 (完整版)

### 🚀 目标

将工作分支上的 N 个零碎提交（例如“备份”、“x”、“日志合并中”等）整合成一个或几个有意义的、干净的提交，同时**确保最终代码内容与当前保持一致**。

### ⚠️ 风险提示

本次操作会修改历史记录。如果您的分支（如 `master`）已经推送到远程仓库，操作完成后必须使用**强制推送 (`git push -f`)**。

------

### 第一步：查看和识别关键提交哈希

首先，我们需要确定三个关键的提交哈希：

| **角色** | **哈希**     | **描述**                              | **对应您的场景** |
| -------- | ------------ | ------------------------------------- | ---------------- |
| **A**    | HEAD / 最新  | 当前代码所在的提交                    | `3dbca69`        |
| **B**    | 最旧需合并   | **需要开始合并**的最旧的提交          | `43f95d1`        |
| **P**    | **变基基准** | 提交 **B** 的父提交，即 rebase 的起点 | `1765aec`        |

> 如何找到 P (变基基准)：
>
> 运行 git log --oneline 43f95d1^ -1（即查看 43f95d1 的父提交）即可得到 1765aec。

### 第二步：确定变基命令 (Rebase Command)

我们将使用交互式变基，并以提交 **P** (`1765aec`) 作为我们操作的起点。

Bash

```
git rebase -i 1765aec
```

### 第三步：编辑提交策略（核心步骤）

执行命令后，Git 会打开一个文本编辑器。列表中的第一行就是提交 **B** (`43f95d1`)，往上是更新的提交，直到 **A** (`3dbca69`)。

您需要修改每一行开头的指令，将零碎的提交融合进第一个提交 **B**。

#### 🔑 核心知识点：为什么第一行必须是 `pick`？

- **`squash` (s) 或 `fixup` (f)** 的操作逻辑是：将当前提交**向上融合**到**上一个**被 `pick` 的提交中。
- 如果列表的第一行被设置为 `s` 或 `f`，它将试图融合进列表范围之外的提交 **P** (`1765aec`)。Git 会报错提示“找不到上一个提交”，因为它必须有一个“容器”来接收所有后续融合进来的代码。
- 因此，列表中的第一个提交 (`43f95d1`) 必须保留为 **`pick`**。

#### 🛠️ 建议的编辑方案

| **原始指令** | **提交哈希** | **提交信息**             | **修改后指令** | **作用**                    |
| ------------ | ------------ | ------------------------ | -------------- | --------------------------- |
| `pick`       | `43f95d1`    | WorkProcess 封装为动态库 | **`pick`**     | **作为基座/容器，保持不变** |
| `pick`       | `7e2cc51`    | 增加ManualWorkProcess... | `s` (squash)   | 融合代码并保留日志          |
| `pick`       | `1830b93`    | 备份                     | `f` (fixup)    | 融合代码并**丢弃**日志      |
| `pick`       | `9a3266e`    | x                        | `f` (fixup)    | 融合代码并**丢弃**日志      |
| ...          | ...          | ...                      | `f / s`        | ...                         |
| `pick`       | `3dbca69`    | 增加CL调试界面           | `s` (squash)   | 融合代码并保留日志          |

**操作提示：** 编辑完成后，保存并关闭编辑器（如 Vim 中输入 `:wq`）。

### 第四步：整理最终日志 (Commit Message)

关闭上一步的编辑器后，Git 会立即弹出另一个编辑器窗口。这里会汇总所有被标记为 `pick` 和 `s` 的提交日志。

请删除所有不需要的文本，**撰写一段清晰、完整的新日志**来概括这 11 个提交的所有工作。

Plaintext

```
# 请在此处编辑新的日志信息。

WorkProcess 模块封装和CL调试功能开发完成

本次提交整合了以下功能：
1. WorkProcess 模块封装为动态库。
2. 实现了 ManualWorkProcess 控制面板。
3. 新增了 CL 调试界面及相关功能。
```

保存并关闭编辑器。此时，您的本地历史记录已完成重写。

### 第五步：强制推送

使用强制推送将新的历史记录覆盖到远程分支。

Bash

```
git push -f origin master
```

------

### 快捷备选方案：`git reset --soft` (一键合并)

如果您不需要精细控制日志，只想将所有提交快速合并成一个，此方法最快：

1. **执行软重置**（回退历史指针到 **P**，保留所有文件修改）：

   Bash

   ```
   git reset --soft 1765aec
   ```

2. **创建新提交**：

   Bash

   ```
   git commit -m "WorkProcess 模块封装和CL调试功能开发整合"
   ```

3. **强制推送**：

   Bash

   ```
   git push -f origin master
   ```